"use strict";const fs=require("graceful-fs"),path=require("path"),copySync=require("../copy").copySync,removeSync=require("../remove").removeSync,mkdirpSync=require("../mkdirs").mkdirpSync,stat=require("../util/stat");function moveSync(e,r,n){const t=(n=n||{}).overwrite||n.clobber||!1,{srcStat:c,isChangingCase:o=!1}=stat.checkPathsSync(e,r,"move",n);return stat.checkParentPathsSync(e,c,r,"move"),isParentRoot(r)||mkdirpSync(path.dirname(r)),doRename(e,r,t,o)}function isParentRoot(e){const r=path.dirname(e);return path.parse(r).root===r}function doRename(e,r,n,t){if(t)return rename(e,r,n);if(n)return removeSync(r),rename(e,r,n);if(fs.existsSync(r))throw new Error("dest already exists.");return rename(e,r,n)}function rename(e,r,n){try{fs.renameSync(e,r)}catch(t){if("EXDEV"!==t.code)throw t;return moveAcrossDevice(e,r,n)}}function moveAcrossDevice(e,r,n){return copySync(e,r,{overwrite:n,errorOnExist:!0}),removeSync(e)}module.exports=moveSync;