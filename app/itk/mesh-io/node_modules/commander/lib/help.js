const{humanReadableArgName}=require("./argument.js");class Help{constructor(){this.helpWidth=void 0,this.sortSubcommands=!1,this.sortOptions=!1}visibleCommands(e){const n=e.commands.filter((e=>!e._hidden));if(e._hasImplicitHelpCommand()){const[,t,r]=e._helpCommandnameAndArgs.match(/([^ ]+) *(.*)/),i=e.createCommand(t).helpOption(!1);i.description(e._helpCommandDescription),r&&i.arguments(r),n.push(i)}return this.sortSubcommands&&n.sort(((e,n)=>e.name().localeCompare(n.name()))),n}visibleOptions(e){const n=e.options.filter((e=>!e.hidden)),t=e._hasHelpOption&&e._helpShortFlag&&!e._findOption(e._helpShortFlag),r=e._hasHelpOption&&!e._findOption(e._helpLongFlag);if(t||r){let i;i=t?r?e.createOption(e._helpFlags,e._helpDescription):e.createOption(e._helpShortFlag,e._helpDescription):e.createOption(e._helpLongFlag,e._helpDescription),n.push(i)}if(this.sortOptions){const e=e=>e.short?e.short.replace(/^-/,""):e.long.replace(/^--/,"");n.sort(((n,t)=>e(n).localeCompare(e(t))))}return n}visibleArguments(e){return e._argsDescription&&e._args.forEach((n=>{n.description=n.description||e._argsDescription[n.name()]||""})),e._args.find((e=>e.description))?e._args:[]}subcommandTerm(e){const n=e._args.map((e=>humanReadableArgName(e))).join(" ");return e._name+(e._aliases[0]?"|"+e._aliases[0]:"")+(e.options.length?" [options]":"")+(n?" "+n:"")}optionTerm(e){return e.flags}argumentTerm(e){return e.name()}longestSubcommandTermLength(e,n){return n.visibleCommands(e).reduce(((e,t)=>Math.max(e,n.subcommandTerm(t).length)),0)}longestOptionTermLength(e,n){return n.visibleOptions(e).reduce(((e,t)=>Math.max(e,n.optionTerm(t).length)),0)}longestArgumentTermLength(e,n){return n.visibleArguments(e).reduce(((e,t)=>Math.max(e,n.argumentTerm(t).length)),0)}commandUsage(e){let n=e._name;e._aliases[0]&&(n=n+"|"+e._aliases[0]);let t="";for(let n=e.parent;n;n=n.parent)t=n.name()+" "+t;return t+n+" "+e.usage()}commandDescription(e){return e.description()}subcommandDescription(e){return e.description()}optionDescription(e){const n=[];return e.argChoices&&!e.negate&&n.push(`choices: ${e.argChoices.map((e=>JSON.stringify(e))).join(", ")}`),void 0===e.defaultValue||e.negate||n.push(`default: ${e.defaultValueDescription||JSON.stringify(e.defaultValue)}`),void 0!==e.envVar&&n.push(`env: ${e.envVar}`),n.length>0?`${e.description} (${n.join(", ")})`:e.description}argumentDescription(e){const n=[];if(e.argChoices&&n.push(`choices: ${e.argChoices.map((e=>JSON.stringify(e))).join(", ")}`),void 0!==e.defaultValue&&n.push(`default: ${e.defaultValueDescription||JSON.stringify(e.defaultValue)}`),n.length>0){const t=`(${n.join(", ")})`;return e.description?`${e.description} ${t}`:t}return e.description}formatHelp(e,n){const t=n.padWidth(e,n),r=n.helpWidth||80;function i(e,i){if(i){const s=`${e.padEnd(t+2)}${i}`;return n.wrap(s,r-2,t+2)}return e}function s(e){return e.join("\n").replace(/^/gm," ".repeat(2))}let o=[`Usage: ${n.commandUsage(e)}`,""];const a=n.commandDescription(e);a.length>0&&(o=o.concat([a,""]));const m=n.visibleArguments(e).map((e=>i(n.argumentTerm(e),n.argumentDescription(e))));m.length>0&&(o=o.concat(["Arguments:",s(m),""]));const p=n.visibleOptions(e).map((e=>i(n.optionTerm(e),n.optionDescription(e))));p.length>0&&(o=o.concat(["Options:",s(p),""]));const c=n.visibleCommands(e).map((e=>i(n.subcommandTerm(e),n.subcommandDescription(e))));return c.length>0&&(o=o.concat(["Commands:",s(c),""])),o.join("\n")}padWidth(e,n){return Math.max(n.longestOptionTermLength(e,n),n.longestSubcommandTermLength(e,n),n.longestArgumentTermLength(e,n))}wrap(e,n,t,r=40){if(e.match(/[\n]\s+/))return e;const i=n-t;if(i<r)return e;const s=e.substr(0,t),o=e.substr(t),a=" ".repeat(t),m=new RegExp(".{1,"+(i-1)+"}([\\s​]|$)|[^\\s​]+?([\\s​]|$)","g");return s+(o.match(m)||[]).map(((e,n)=>("\n"===e.slice(-1)&&(e=e.slice(0,e.length-1)),(n>0?a:"")+e.trimRight()))).join("\n")}}exports.Help=Help;