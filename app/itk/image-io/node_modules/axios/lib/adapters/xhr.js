"use strict";var utils=require("./../utils"),settle=require("./../core/settle"),cookies=require("./../helpers/cookies"),buildURL=require("./../helpers/buildURL"),buildFullPath=require("../core/buildFullPath"),parseHeaders=require("./../helpers/parseHeaders"),isURLSameOrigin=require("./../helpers/isURLSameOrigin"),createError=require("../core/createError"),defaults=require("../defaults"),Cancel=require("../cancel/Cancel");module.exports=function(e){return new Promise((function(r,t){var s,n=e.data,o=e.headers,a=e.responseType;function i(){e.cancelToken&&e.cancelToken.unsubscribe(s),e.signal&&e.signal.removeEventListener("abort",s)}utils.isFormData(n)&&delete o["Content-Type"];var u=new XMLHttpRequest;if(e.auth){var l=e.auth.username||"",d=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";o.Authorization="Basic "+btoa(l+":"+d)}var c=buildFullPath(e.baseURL,e.url);function p(){if(u){var s="getAllResponseHeaders"in u?parseHeaders(u.getAllResponseHeaders()):null,n={data:a&&"text"!==a&&"json"!==a?u.response:u.responseText,status:u.status,statusText:u.statusText,headers:s,config:e,request:u};settle((function(e){r(e),i()}),(function(e){t(e),i()}),n),u=null}}if(u.open(e.method.toUpperCase(),buildURL(c,e.params,e.paramsSerializer),!0),u.timeout=e.timeout,"onloadend"in u?u.onloadend=p:u.onreadystatechange=function(){u&&4===u.readyState&&(0!==u.status||u.responseURL&&0===u.responseURL.indexOf("file:"))&&setTimeout(p)},u.onabort=function(){u&&(t(createError("Request aborted",e,"ECONNABORTED",u)),u=null)},u.onerror=function(){t(createError("Network Error",e,null,u)),u=null},u.ontimeout=function(){var r=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",s=e.transitional||defaults.transitional;e.timeoutErrorMessage&&(r=e.timeoutErrorMessage),t(createError(r,e,s.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",u)),u=null},utils.isStandardBrowserEnv()){var f=(e.withCredentials||isURLSameOrigin(c))&&e.xsrfCookieName?cookies.read(e.xsrfCookieName):void 0;f&&(o[e.xsrfHeaderName]=f)}"setRequestHeader"in u&&utils.forEach(o,(function(e,r){void 0===n&&"content-type"===r.toLowerCase()?delete o[r]:u.setRequestHeader(r,e)})),utils.isUndefined(e.withCredentials)||(u.withCredentials=!!e.withCredentials),a&&"json"!==a&&(u.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&u.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&u.upload&&u.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(s=function(e){u&&(t(!e||e&&e.type?new Cancel("canceled"):e),u.abort(),u=null)},e.cancelToken&&e.cancelToken.subscribe(s),e.signal&&(e.signal.aborted?s():e.signal.addEventListener("abort",s))),n||(n=null),u.send(n)}))};