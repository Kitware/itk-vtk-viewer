"use strict";const fs=require("graceful-fs"),path=require("path"),copy=require("../copy").copy,remove=require("../remove").remove,mkdirp=require("../mkdirs").mkdirp,pathExists=require("../path-exists").pathExists,stat=require("../util/stat");function move(e,r,t,o){"function"==typeof t&&(o=t,t={});const s=(t=t||{}).overwrite||t.clobber||!1;stat.checkPaths(e,r,"move",t,((t,i)=>{if(t)return o(t);const{srcStat:n,isChangingCase:a=!1}=i;stat.checkParentPaths(e,n,r,"move",(t=>t?o(t):isParentRoot(r)?doRename(e,r,s,a,o):void mkdirp(path.dirname(r),(t=>t?o(t):doRename(e,r,s,a,o)))))}))}function isParentRoot(e){const r=path.dirname(e);return path.parse(r).root===r}function doRename(e,r,t,o,s){return o?rename(e,r,t,s):t?remove(r,(o=>o?s(o):rename(e,r,t,s))):void pathExists(r,((o,i)=>o?s(o):i?s(new Error("dest already exists.")):rename(e,r,t,s)))}function rename(e,r,t,o){fs.rename(e,r,(s=>s?"EXDEV"!==s.code?o(s):moveAcrossDevice(e,r,t,o):o()))}function moveAcrossDevice(e,r,t,o){copy(e,r,{overwrite:t,errorOnExist:!0},(r=>r?o(r):remove(e,o)))}module.exports=move;